# 大屏可视化项目-新冠疫情监测

### 大屏项目基础介绍

https://www.jianshu.com/p/cbbf9fc80edc   大屏项目业务背景

https://gitee.com/kuige168/DaShuJuZhiDaPingZhanShi   各种大屏可视化项目参考

大屏可视化项目总结:
  这是一个大屏可视化项目,主要在大屏幕上展示。该项目是用于监测新冠疫情的流行情况。主要用到了echarts里的柱状图,折线图,饼状图，中国地图,世界地图等,涉及到的技术点有页面的适配，用到了插件px转vw(postcss-px-to-viewport),帮你自动把px转换为vw达到页面的自适应。
  在该项目中，为了方便维护，管理。我把用到的图表统一摘出了一个公共组件，该公共组件内用插槽封装了标题与内容区，每个图表外面用时只需传入标题和各自的div块即可。所有的图表配置项option，统一都弄到了一个js文件里方便管理。还封装了promise进行统一网络请求,把请求到数据统一返回到外面，外面页面调用时，把数据给每个组件即可。

图表参考资料:

百度ehcarts-https://echarts.apache.org/examples/zh/index.html

echarts图表交流社区-https://www.makeapie.cn/echarts

### 初始化项目

#### 1.npm方式安装echarts,jquery(因为项目中接口是jsonp格式)

   1.1 echarts引入

   npm install echarts@4.9  --save

 //！！！注意要在组件内引入
 import  echarts  from  'echarts'
 //如果在main.js中，要挂载到vue的原型中
 Vue.prototype.$echarts = echarts

 1.2 jquery引入

 npm install jquery --save

 //！！！注意要在组件内引入

 import  $  from  'jquery'



#### 2.cdn方式引echarts,jquery 在public/index.html中

```html
<script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/echarts/4.8.0/echarts-en.min.js></script>
		<script src=https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.js></script>
```

```javascript
//vue.config.js 配置打包排除项   
chainWebpack: config => {
        // 用cdn方式引入
        config.externals({
		  "echarts": "echarts",
		   "$": "jquery",
        })
      },
```

## 自适应页面方式
大屏项目，一般设计图是1920，如何自适应匹配任何屏幕？
可用自动转换vh,vw插件postcss-px-to-viewport，配置下宽度即可。布局时按照设计图量多少就写多少px,编译生成该插件会自动将px转换为vh,vw。

 布局方案postcss-px-to-viewport介绍 https://blog.csdn.net/Amnesiac666/article/details/112318281 

```javascript
//采用vm的方式实现自适应页面
npm install postcss-px-to-viewport --save-dev
css: {
    loaderOptions: {
      postcss: {
        plugins: [
          require("postcss-px-to-viewport")({
            unitToConvert: "px",
            viewportWidth: 1920,
            viewportHeight: 667, // 视窗的高度, 根据375设备的宽度来指定，一般是667，也可不配置
            unitPrecision: 3,//(Number)指定`px`转换为视窗单位值的小数位数，默认是5
            propList: [   // 转化为vw的属性列表
              "*"
            ],
            selectorBlackList: ['.ignore', '.hairlines'], // (Array) 指定不转换为视窗单位的类，保留px，值为string或正则regexp，建议定义一至两个通用的类名
            viewportUnit: "vw",
            fontViewportUnit: "vw",
            selectorBlackList: [],
            minPixelValue: 1,
            mediaQuery: false,
            replace: true,
            exclude: /(\/|\\)(node_modules)(\/|\\)/,
          })
        ]
      }
    }
  }

//注意，最外面的包围壳如果宽度是100vw，但高度上面出现滚动条的时候，宽度100vm的值不会变，会有一部分内容出现在垂直滚动条后面，此时，水平方向上也会出现滚动条
//通过下面方式，可以设置不让页面水平方向上出现滚动条，但是，会有一部分内容被遮挡在垂直滚动条后面。
/* 	html {
	overflow-y: scroll;
	}
	body {
	overflow: hidden;
	}
	 */
//本页面采用的方式是设置最外面的包围壳如果宽度是100vw-15px(这个15px不能转化成vw，不同尺寸下的浏览器的垂直滚动条都是这个尺寸) 缺点是，但没有垂直滚动条的时候，页面最右边会有15px大小的空白，不过还可以接受

```

## 接口

本项目有跨域，可用jsonp请求跨域，可自己封装一个jsonp，也可以用jquery中的 $.ajax({url:'',dataType:'jsonp'})。

 以下是自己封装jsonp方法，

```javascript
 
export  function jsonp({url,params={},success}){
                // 根据时间戳生成一个callback名
                let callbackName = `jsonp_${new Date().getTime()}`;

                // 创建script
                let script = document.createElement('script');

                // 字符串拼接生成基本url
                let baseUrl = `${url}?callback=${callbackName}`;

                // 取出params对象属性并得到完整url
                for(let item in params){
                    baseUrl += `&${item}=${params[item]}`;
                }
                // jsonp核心，通过script的跨域特性发出请求
                script.src = baseUrl;
                // 把创建的script挂载到DOM
                document.body.appendChild(script);

                // 给window添加属性，用于获取jsonp结果
                window[callbackName] = (res)=>{
                    // 执行success回调
                    success(res);
                    // 删除window下属性
                    delete window[callbackName];
                    // 得到结果后删除创建的script
                    document.body.removeChild(script);
                }

            }
```

### 国外数据
https://view.inews.qq.com/g2/getOnsInfo?name=disease_foreign

```javascript
//主要疫情国家治愈率
'foreignList':
{
            "name":"美国",
            "continent":"北美洲",
            "date":"05.27",
            "isUpdated":true,
            "confirmAdd":19049,
            "confirmAddCut":0,
            "confirm":1725275,
            "suspect":0,
            "dead":100579,
            "heal":479969,
             "nowConfirm":1144727,
            "confirmCompare":19049,
            "nowConfirmCompare":2976,
            "healCompare":15299,
            "deadCompare":774,
            "children":{}
}
//全球病情统计-中间世界数据用
"globalStatis":{
        "nowConfirm":2898884,//现存确诊
        "confirm":5594262, //累计确诊
        "heal":2347956,//累计治愈
        "dead":347422,//累计死亡
        "nowConfirmAdd":22880,
        "confirmAdd":62982,
        "healAdd":38283,
        "deadAdd":3238,
        "lastUpdateTime":"2020-05-27 12:17:36"
    },
//世界每周新增治愈和死亡人数
"globalDailyHistory":[
        {
            "date":"01.28",
            "all":{
                "confirm":57,
                "dead":0,
                "heal":3,
                "newAddConfirm":19,
                "deadRate":"0.00",
                "healRate":"5.26"
            }
    ]
//境外输入病情top10省份
"importStatis":{
        "TopList":[{
                "province":"黑龙江",
                "importedCase":386
        }]
    },
    // 新增确诊TOP10        
"countryAddConfirmRankList":[
    {
            "nation":"美国",
            "addConfirm":26158
        },
]   

```
### 国内数据

"https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5"

```javascript

 //国内总数据
"chinaTotal":{
        "confirm":84544,//累计确诊
        "heal":79774,
        "dead":4645,
        "nowConfirm":125,//现存确诊
        "suspect":6,
        "nowSevere":5,
        "importedCase":1732,
        "noInfect":404
    },
//具体各个省数据-本项目用不到
"areaTree":{
    {
            "name":"中国",
            "today":{
                "confirm":1,
                "isUpdated":true
            },
            "children":[
                {
                    "name":"内蒙古",
                    "today":{
                        "confirm":0,
                        "confirmCuts":0,
                        "isUpdated":true,
                        "tip":"内蒙古自治区累计报告境外输入确诊病例155例。"
                    },
                    "total":{
                        "nowConfirm":26,
                        "confirm":232,
                        "suspect":0,
                        "dead":1,
                        "deadRate":"0.43",
                        "showRate":false,
                        "heal":205,
                        "healRate":"88.36",
                        "showHeal":true
                    },
                    "children":[{
                            "name":"呼伦贝尔",
                            "today":{
                                "confirm":0,
                                "confirmCuts":0,
                                "isUpdated":false
                            },
                            "total":{
                                "nowConfirm":0,
                                "confirm":9,
                                "suspect":0,
                                "dead":0,
                                "deadRate":"0.00",
                                "showRate":false,
                                "heal":9,
                                "healRate":"100.00",
                                "showHeal":true
                            }
                        },
                    ]
            ]
}
```

###  左1柱状图参考 

   https://www.makeapie.cn/echarts_content/xKURdt9zOe.html

​    修改如下：

​    let xAxis=['英国', '印度尼西亚', '巴西', '印度', '伊朗', '俄罗斯', '哥伦比亚', '孟加拉国', '泰国', '马来西亚']

​    let  yAxis =  [39538, 38325, 34126, 30093, 25441, 23770, 18206, 11579, 11305, 10972]

​    *let* option = {

​    tooltip: {

​     trigger: "axis",

​     axisPointer: {

​      type: "shadow",

​     },

​    },

​    grid: {

​     top: "3px",

​     left: "3%",

​     right: "4%",

​     bottom: "3px",

​     containLabel: true,

​    },

​    xAxis: [

​     {

​      type: "category",

​      data: xAxis,

​      // 修改刻度标签 相关样式

​      axisLabel: {

​       color: "rgba(255,255,255,.6) ",

​       fontSize: 10,

​      },

​     },

​    ],

​    yAxis: [

​     {

​      type: "value",

​      splitLine: {

​       show: false,

​      },

​      // 修改刻度标签 相关样式

​      axisLabel: {

​       color: "rgba(255,255,255,.6) ",

​       fontSize: 10,

​      },

​     },

​    ],

​    series: [

​     {

​      name: "新增确认",

​      type: "bar",

​      barWidth: "20%",

​      itemStyle: {

​       normal: {

​        barBorderRadius: 30,

​        color: "#3B80E2",

​       },

​      },

​      data: yAxis,

​     },

​    ],

   };

### 世界地图参考

世界地图这两个你可以参考结合下
https://www.makeapie.cn/echarts_content/map-world-dataRange.html
https://www.makeapie.cn/echarts_content/xS1Edb0qnz.html

 ！！！注意一般地图类图表的，都需要下载地图的数据js文件。点击外部脚本下载下，项目中引入即可

import 'commonfun/world.js'

## 自己建脚手架问题

 1.如果脚手架vue-cli版本是5开头搭建的,下载vw插件postcss-px-to-viewport会报错版本不对

   解决办法1     vue-cli5中使用方法    https://blog.csdn.net/CSTGShaGuo/article/details/123141613  

   "devDependencies": {
    "@vue/cli-plugin-babel": "~5.0.0",
    "@vue/cli-plugin-router": "~5.0.0",
    "@vue/cli-plugin-vuex": "~5.0.0",
    "@vue/cli-service": "~5.0.0",
    "sass": "^1.32.7",
    "sass-loader": "^12.0.0",

​      "postcss-loader":"^6.2.1",

​    "postcss-px-to-viewport": "^1.1.1",

​    "vue-template-compiler": "^2.6.14"
  },

vue.config.js里配置

css: {
    loaderOptions: {
      postcss: {
        postcssOptions: {
          plugins: [
            [
              'postcss-px-to-viewport',
              {
                unitToConvert: 'px',    // 需要转换的单位，默认为"px"
                viewportWidth: 1920,     // 设计稿的视窗宽度
                unitPrecision: 5,       // 单位转换后保留的精度
                propList: ['*', '!font-size'],        // 能转化为 vw 的属性列表
                viewportUnit: 'vw',     // 希望使用的视窗单位
                fontViewportUnit: 'vw', // 字体使用的视窗单位
                selectorBlackList: [],  // 需要忽略的 CSS 选择器，不会转为视窗单位，使用原有的 px 等单位
                minPixelValue: 1,       // 设置最小的转换数值，如果为 1 的话，只有大于 1 的值会被转换
                mediaQuery: false,      // 媒体查询里的单位是否需要转换单位
                replace: true,          // 是否直接更换属性值，而不添加备用属性
                exclude: undefined,     // 忽略某些文件夹下的文件或特定文件，例如 'node_modules' 下的文件
                include: /\/src\//,     // 如果设置了include，那将只有匹配到的文件才会被转换
                landscape: false,       // 是否添加根据 landscapeWidth 生成的媒体查询条件
                landscapeUnit: 'vw',    // 横屏时使用的单位
                landscapeWidth: 1125,   // 横屏时使用的视窗宽度
              },
            ],
          ],
        },
      }
    }
  }